<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Demo - Data Collected</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #111; color: #fff; }
        .box { background: #222; padding: 20px; border-radius: 10px; margin-top: 20px; display: inline-block; text-align: left; }
        h2 { color: #ff4d4d; }
    </style>
</head>
<body>
    <h2>QR Code Data Collection Demo</h2>
    <div class="box" id="collected-data">
        <p><strong>Email:</strong> <span id="email">Loading...</span></p>
        <p><strong>Device Model:</strong> <span id="device">Loading...</span></p>
        <p><strong>Browser:</strong> <span id="browser">Loading...</span></p>
        <p><strong>Language:</strong> <span id="language">Loading...</span></p>
        <p><strong>Screen Resolution:</strong> <span id="screen">Loading...</span></p>
        <p><strong>User Agent:</strong> <span id="useragent">Loading...</span></p>
        <p><strong>IP Address:</strong> <span id="ip">Loading...</span></p>
    </div>

    <script>
        // URL-safe Base64 decode
        function base64UrlDecode(str) {
            str = str.replace(/-/g, '+').replace(/_/g, '/');
            while (str.length % 4) str += '=';
            return atob(str);
        }

        function getDeviceInfo() {
            const ua = navigator.userAgent;
            if (/iPhone/.test(ua)) return 'iPhone';
            if (/iPad/.test(ua)) return 'iPad';
            if (/Android/.test(ua)) return 'Android Device';
            if (/Windows/.test(ua)) return 'Windows PC';
            if (/Mac/.test(ua)) return 'Mac';
            if (/Linux/.test(ua)) return 'Linux PC';
            return 'Unknown Device';
        }

        function getBrowserInfo() {
            const ua = navigator.userAgent;
            if (/Chrome/.test(ua) && !/Edge/.test(ua)) return 'Chrome';
            if (/Firefox/.test(ua)) return 'Firefox';
            if (/Safari/.test(ua) && !/Chrome/.test(ua)) return 'Safari';
            if (/Edge/.test(ua)) return 'Edge';
            if (/Opera/.test(ua)) return 'Opera';
            return 'Unknown Browser';
        }

        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'Unable to fetch IP';
            }
        }

        async function displayCollectedData() {
            const params = new URLSearchParams(window.location.search);
            let email = 'No email found';
            if (params.has('email')) {
                try {
                    email = base64UrlDecode(params.get('email'));
                } catch (err) {
                    console.error('Error decoding email:', err);
                    email = 'Error decoding email';
                }
            }

            document.getElementById('email').textContent = email;
            document.getElementById('device').textContent = getDeviceInfo();
            document.getElementById('browser').textContent = getBrowserInfo();
            document.getElementById('language').textContent = navigator.language || 'Unknown';
            document.getElementById('screen').textContent = `${screen.width}x${screen.height}`;
            document.getElementById('useragent').textContent = navigator.userAgent;

            const ip = await getIPAddress();
            document.getElementById('ip').textContent = ip;
        }

        window.onload = displayCollectedData;
    </script>
</body>
</html>
