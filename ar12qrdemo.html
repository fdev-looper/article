<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Demo - Data Collected</title>
</head>
<body>
    <h2>QR Code Data Collection Demo</h2>
    <p><strong>Data collected silently when QR was scanned:</strong></p>
    
    <div id="collected-data">
        <p><strong>Email:</strong> <span id="email">Loading...</span></p>
        <p><strong>Device Model:</strong> <span id="device">Loading...</span></p>
        <p><strong>Browser:</strong> <span id="browser">Loading...</span></p>
        <p><strong>Language:</strong> <span id="language">Loading...</span></p>
        <p><strong>IP Address:</strong> <span id="ip">Loading...</span></p>
        <p><strong>Screen Resolution:</strong> <span id="screen">Loading...</span></p>
        <p><strong>User Agent:</strong> <span id="useragent">Loading...</span></p>
    </div>

    <script>
        function getDeviceInfo() {
            const ua = navigator.userAgent;
            let device = 'Unknown Device';
            
            if (/iPhone/.test(ua)) device = 'iPhone';
            else if (/iPad/.test(ua)) device = 'iPad';
            else if (/Android/.test(ua)) device = 'Android Device';
            else if (/Windows/.test(ua)) device = 'Windows PC';
            else if (/Mac/.test(ua)) device = 'Mac';
            else if (/Linux/.test(ua)) device = 'Linux PC';
            
            return device;
        }

        function getBrowserInfo() {
            const ua = navigator.userAgent;
            let browser = 'Unknown Browser';
            
            if (/Chrome/.test(ua) && !/Edge/.test(ua)) browser = 'Chrome';
            else if (/Firefox/.test(ua)) browser = 'Firefox';
            else if (/Safari/.test(ua) && !/Chrome/.test(ua)) browser = 'Safari';
            else if (/Edge/.test(ua)) browser = 'Edge';
            else if (/Opera/.test(ua)) browser = 'Opera';
            
            return browser;
        }

        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'Unable to fetch IP';
            }
        }

        function displayCollectedData() {
            // Get data from URL fragment (after #)
            const fragment = window.location.hash.substring(1);
            
            let email = 'No email found';
            
            if (fragment) {
                try {
                    const decodedData = JSON.parse(atob(fragment));
                    email = decodedData.email || 'No email found';
                } catch (error) {
                    console.error('Error decoding fragment data:', error);
                }
            }
            
            // Clean the URL to hide the data (optional)
            if (window.history && window.history.replaceState) {
                window.history.replaceState({}, document.title, window.location.pathname);
            }
            
            // Display all collected data
            document.getElementById('email').textContent = email;
            document.getElementById('device').textContent = getDeviceInfo();
            document.getElementById('browser').textContent = getBrowserInfo();
            document.getElementById('language').textContent = navigator.language || 'Unknown';
            document.getElementById('screen').textContent = `${screen.width}x${screen.height}`;
            document.getElementById('useragent').textContent = navigator.userAgent;
            
            // Get IP address
            getIPAddress().then(ip => {
                document.getElementById('ip').textContent = ip;
            });
        }

        // Load data when page loads
        displayCollectedData();
    </script>
</body>
</html>
